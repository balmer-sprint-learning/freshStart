<!DOCTYPE html>
<html>
<head><title>Check Settings in IndexedDB</title></head>
<body>
<div id='result'>Checking settings/profile data in IndexedDB...</div>
<script>
async function checkSettings() {
  const resultDiv = document.getElementById('result');
  
  try {
    const db = await new Promise((resolve, reject) => {
      const request = indexedDB.open('FreshStartDB', 1);
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => resolve(null);
      request.onupgradeneeded = () => {
        resultDiv.innerHTML = '❌ Database does not exist (onupgradeneeded fired)';
        resolve(null);
      };
    });
    
    if (!db) return;
    
    let html = '<h3>Checking for settings/profile data:</h3>';
    
    // Check for settings store
    if (db.objectStoreNames.contains('settings')) {
      const transaction1 = db.transaction(['settings'], 'readonly');
      const store1 = transaction1.objectStore('settings');
      
      const settings = await new Promise((resolve, reject) => {
        const request = store1.get('current');
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => resolve(null);
      });
      
      if (settings && settings.data) {
        html += `✅ SETTINGS EXISTS in IndexedDB<br>Data: ${settings.data.substring(0, 300)}...<br><br>`;
      } else {
        html += '❌ NO settings data found<br><br>';
      }
    } else {
      html += '❌ NO settings object store exists<br><br>';
    }
    
    // Check for profiles store  
    if (db.objectStoreNames.contains('profiles')) {
      const transaction2 = db.transaction(['profiles'], 'readonly');
      const store2 = transaction2.objectStore('profiles');
      
      const profiles = await new Promise((resolve, reject) => {
        const request = store2.get('current');
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => resolve(null);
      });
      
      if (profiles && profiles.data) {
        html += `✅ PROFILES EXISTS in IndexedDB<br>Data: ${profiles.data.substring(0, 300)}...<br><br>`;
      } else {
        html += '❌ NO profiles data found<br><br>';
      }
    } else {
      html += '❌ NO profiles object store exists<br><br>';
    }
    
    // List all stores
    html += `<strong>All object stores:</strong> ${Array.from(db.objectStoreNames).join(', ')}`;
    
    resultDiv.innerHTML = html;
    db.close();
    
  } catch(e) {
    resultDiv.innerHTML = `Error: ${e.message}`;
  }
}
checkSettings();
</script>
</body>
</html>
