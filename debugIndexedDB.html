<!DOCTYPE html>
<html>
<head><title>IndexedDB Debug</title></head>
<body>
<div id='result'>Checking IndexedDB contents...</div>
<script>
async function debugIndexedDB() {
  const resultDiv = document.getElementById('result');
  
  try {
    const request = indexedDB.open('FreshStartDB', 1);
    
    request.onsuccess = async function(event) {
      const db = event.target.result;
      const objectStoreNames = Array.from(db.objectStoreNames);
      
      let html = `<h3>Database: FreshStartDB</h3>`;
      html += `<p>Object stores: ${objectStoreNames.join(', ')}</p>`;
      
      // Check each store for data
      for (const storeName of objectStoreNames) {
        try {
          const transaction = db.transaction([storeName], 'readonly');
          const store = transaction.objectStore(storeName);
          
          const data = await new Promise((resolve, reject) => {
            const request = store.get('current');
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => resolve(null);
          });
          
          html += `<h4>${storeName}:</h4>`;
          if (data) {
            html += `<p>✅ Data exists (${JSON.stringify(data).length} characters)</p>`;
            html += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
          } else {
            html += `<p>❌ No data found</p>`;
          }
        } catch (e) {
          html += `<h4>${storeName}:</h4><p>❌ Error: ${e.message}</p>`;
        }
      }
      
      resultDiv.innerHTML = html;
      db.close();
    };
    
    request.onerror = function() {
      resultDiv.innerHTML = 'No IndexedDB database found';
    };
    
    request.onupgradeneeded = function(event) {
      resultDiv.innerHTML = 'Database would be created (onupgradeneeded fired)';
    };
    
  } catch(e) {
    resultDiv.innerHTML = 'Error: ' + e.message;
  }
}
debugIndexedDB();
</script>
</body>
</html>
