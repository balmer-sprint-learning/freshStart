<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test formatUnderscoreText Function</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .input { background: #f5f5f5; padding: 5px; margin: 5px 0; }
        .output { border: 1px solid #ddd; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>formatUnderscoreText Function Test</h1>
    
    <div class="test-case">
        <h3>Test 1: Basic underscore formatting with spaces</h3>
        <div class="input">Input: "Hello _world_ and _beautiful_ day"</div>
        <div class="output" id="test1"></div>
    </div>
    
    <div class="test-case">
        <h3>Test 2: Custom red color with spaces</h3>
        <div class="input">Input: "The _quick brown fox_ jumps" with color "#ff0000"</div>
        <div class="output" id="test2"></div>
    </div>
    
    <div class="test-case">
        <h3>Test 3: Multiple words with proper spacing</h3>
        <div class="input">Input: "Learn _Spanish verbs_ and _French grammar_ today"</div>
        <div class="output" id="test3"></div>
    </div>
    
    <div class="test-case">
        <h3>Test 4: No underscores</h3>
        <div class="input">Input: "Plain text with no formatting"</div>
        <div class="output" id="test4"></div>
    </div>
    
    <div class="test-case">
        <h3>Test 5: Single underscore (should not format)</h3>
        <div class="input">Input: "Text with single _ underscore"</div>
        <div class="output" id="test5"></div>
    </div>
    
    <div class="test-case">
        <h3>Test 6: Space preservation test</h3>
        <div class="input">Input: "Before_word_after and before _spaced word_ after"</div>
        <div class="output" id="test6"></div>
    </div>

    <div class="test-case">
        <h3>Test 6: Form Field Overlay Test</h3>
        <div class="input">Testing overlay technique on textarea</div>
        <textarea id="testField" readonly style="width: 300px; height: 60px; position: relative;">The _quick brown fox_ jumps over the _lazy dog_ today</textarea>
        <button onclick="testOverlay()">Apply Formatting</button>
    </div>

    <script>
        // Copy the updated formatUnderscoreText function here for testing
        function formatUnderscoreText(text, color = '#0066ff') {
          if (typeof text !== 'string') {
            console.warn('formatUnderscoreText: text parameter must be a string');
            return '';
          }
          
          if (typeof color !== 'string') {
            console.warn('formatUnderscoreText: color parameter must be a string, using default blue');
            color = '#0066ff';
          }
          
          // Pattern: captures spaces before/after underscores and preserves them
          const styledText = text.replace(/(\s*)_([^_]+)_(\s*)/g, (match, spaceBefore, content, spaceAfter) => {
            return `${spaceBefore}<span style="font-weight: bold; color: ${color};">${content}</span>${spaceAfter}`;
          });
          
          return styledText;
        }

        // Run tests
        document.getElementById('test1').innerHTML = formatUnderscoreText("Hello _world_ and _beautiful_ day");
        document.getElementById('test2').innerHTML = formatUnderscoreText("The _quick brown fox_ jumps", "#ff0000");
        document.getElementById('test3').innerHTML = formatUnderscoreText("Learn _Spanish verbs_ and _French grammar_ today");
        document.getElementById('test4').innerHTML = formatUnderscoreText("Plain text with no formatting");
        document.getElementById('test5').innerHTML = formatUnderscoreText("Text with single _ underscore");
        document.getElementById('test6').innerHTML = formatUnderscoreText("Before_word_after and before _spaced word_ after");
    </script>
</body>
</html>
