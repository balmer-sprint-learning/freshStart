<!DOCTYPE html>
<html>
<head>
    <title>Count Events Test</title>
</head>
<body>
    <h1>Event Counter</h1>
    
    <button onclick="countEvents()">Count Events</button>
    <button onclick="countUserData()">Count User Data</button>
    <button onclick="findNickname()">Find Nickname</button>
    
    <textarea id="output" rows="10" cols="50"></textarea>
    
    <script src="dataManager.js"></script>
    <script>
        function countEvents() {
            const startTime = performance.now();
            
            const content = localStorage.getItem('events');
            if (!content) {
                document.getElementById('output').value = 'No events data found';
                return;
            }
            
            const lines = content.split(/\r\n|\r|\n/).length;
            const endTime = performance.now();
            const time = (endTime - startTime).toFixed(2);
            
            document.getElementById('output').value = `Events: ${lines} lines\nTime: ${time}ms`;
        }
        
        function countUserData() {
            const startTime = performance.now();
            
            const content = localStorage.getItem('userData');
            if (!content) {
                document.getElementById('output').value = 'No userData found';
                return;
            }
            
            const allLines = content.split(/\r\n|\r|\n/);
            let dataLines = 0;
            let headerRowIndex = null;
            
            // Find header row from comment
            for (let i = 0; i < allLines.length; i++) {
                const line = allLines[i].trim();
                if (line.includes('# headerRow =')) {
                    const match = line.match(/headerRow\s*=\s*(\d+)/);
                    if (match) {
                        headerRowIndex = parseInt(match[1]) - 1; // Convert to 0-based
                        break;
                    }
                }
            }
            
            // Count data lines (skip comments, empty lines, and header)
            for (let i = 0; i < allLines.length; i++) {
                const line = allLines[i].trim();
                if (line && !line.startsWith('#') && i !== headerRowIndex) {
                    dataLines++;
                }
            }
            
            const endTime = performance.now();
            const time = (endTime - startTime).toFixed(2);
            
            document.getElementById('output').value = `User Data: ${dataLines} data lines (${allLines.length} total, header at line ${headerRowIndex + 1})\nTime: ${time}ms`;
        }
        
        function findNickname() {
            const startTime = performance.now();
            
            const content = localStorage.getItem('settings');
            if (!content) {
                document.getElementById('output').value = 'No settings data found';
                return;
            }
            
            const lines = content.split(/\r\n|\r|\n/);
            let headerRowIndex = null;
            let nickname = null;
            
            // Find header row from comment
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.includes('# headerRow =')) {
                    const match = line.match(/headerRow\s*=\s*(\d+)/);
                    if (match) {
                        headerRowIndex = parseInt(match[1]) - 1; // Convert to 0-based
                        break;
                    }
                }
            }
            
            // Look for nickname in data lines
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line && !line.startsWith('#') && i !== headerRowIndex) {
                    const columns = line.split('\t');
                    if (columns.length >= 2 && columns[0].trim().toLowerCase() === 'nickname') {
                        nickname = columns[1].trim();
                        break;
                    }
                }
            }
            
            const endTime = performance.now();
            const time = (endTime - startTime).toFixed(2);
            
            if (nickname) {
                document.getElementById('output').value = `Nickname found: "${nickname}"\nTime: ${time}ms`;
            } else {
                document.getElementById('output').value = `Nickname not found\nTime: ${time}ms`;
            }
        }
    </script>
</body>
</html>
