<!DOCTYPE html>
<html>
<head><title>Clear All Data</title></head>
<body>
<div id='result'>Ready to clear all data...</div>
<button onclick="clearAllData()" style="padding: 10px 20px; font-size: 16px; background: red; color: white; border: none; cursor: pointer;">CLEAR ALL DATA</button>
<script>
async function clearAllData() {
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = 'Clearing all data...';
  
  try {
    // Clear localStorage
    localStorage.clear();
    console.log('✅ localStorage cleared');
    
    // Clear IndexedDB
    const databases = await indexedDB.databases();
    console.log('Found databases:', databases);
    
    for (const db of databases) {
      await new Promise((resolve, reject) => {
        const deleteRequest = indexedDB.deleteDatabase(db.name);
        deleteRequest.onsuccess = () => {
          console.log(`✅ Deleted database: ${db.name}`);
          resolve();
        };
        deleteRequest.onerror = () => {
          console.error(`❌ Failed to delete database: ${db.name}`);
          reject(deleteRequest.error);
        };
        deleteRequest.onblocked = () => {
          console.warn(`⚠️ Database deletion blocked: ${db.name}`);
          // Force resolve after a delay
          setTimeout(resolve, 1000);
        };
      });
    }
    
    // Also specifically try to delete FreshStartDB
    await new Promise((resolve, reject) => {
      const deleteRequest = indexedDB.deleteDatabase('FreshStartDB');
      deleteRequest.onsuccess = () => {
        console.log('✅ Deleted FreshStartDB specifically');
        resolve();
      };
      deleteRequest.onerror = () => {
        console.log('⚠️ FreshStartDB may not have existed');
        resolve(); // Don't reject, it might not exist
      };
      deleteRequest.onblocked = () => {
        console.warn('⚠️ FreshStartDB deletion blocked');
        setTimeout(resolve, 1000);
      };
    });
    
    resultDiv.innerHTML = `
      <h2>✅ ALL DATA CLEARED</h2>
      <p>✅ localStorage cleared</p>
      <p>✅ IndexedDB cleared</p>
      <p><strong>Now go to <a href="/">http://localhost:8000/</a> and you should be redirected to profile page</strong></p>
    `;
    
  } catch (error) {
    resultDiv.innerHTML = `❌ Error clearing data: ${error.message}`;
    console.error('Error:', error);
  }
}
</script>
</body>
</html>
